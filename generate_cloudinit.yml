---
- name: Generate cloud-init configuration
  hosts: localhost
  gather_facts: true
  tasks:
    - name: Create rancher-helmchart configuration
      ansible.builtin.template:
        src: rancher-helmchart.yml.j2
        dest: rancher-helmchart.yml
    - name: Create certmanager-helmchart configuration
      ansible.builtin.template:
        src: certmanager-helmchart.yml.j2
        dest: certmanager-helmchart.yml
    - name: Create certmanager-helm-values configuration
      ansible.builtin.template:
        src: certmanager-helm-values.yml.j2
        dest: certmanager-helm-values.yml
    - name: Create rancher-helm-values configuration
      ansible.builtin.template:
        src: rancher-helm-values.yml.j2
        dest: rancher-helm-values.yml
    - name: Create cloud-init configuration
      ansible.builtin.template:
        src: cloud-init.yml.j2     
        dest: cloud-init.yml
    - name: Base64 encode the rendered template
      command: base64 -w 0 cloud-init.yml
      register: base64_cloud_init
    - name: Create rancher-harvester configuration
      ansible.builtin.template:
        src: rancher-harvester.yml.j2
        dest: rancher-harvester.yml
    - name: Create rancher-lima configuration
      ansible.builtin.template:
        src: rancher-lima.yml.j2
        dest: rancher-lima.yml
